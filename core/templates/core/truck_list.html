{% extends "core/base.html" %}
{% block title %}Caminhões – {{ company.name }}{% endblock %}
{% block content %}
<div class="bg-white rounded-lg shadow-md p-6">
  <!-- Cabeçalho da página -->
  <div class="flex items-center justify-between mb-6 border-b border-gray-200 pb-4 gap-3 flex-wrap">
    <h1 class="text-2xl font-bold text-secondary">Caminhões – {{ company.name }}</h1>
    
    <div class="flex gap-2 w-full sm:w-auto justify-end">
      <!-- Botão de relatório por período -->
      <a href="{% url 'inspection_reports:report_by_month' %}?company_id={{ company.id }}"
         class="px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors flex items-center w-full sm:w-auto justify-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
        Relatório
      </a>
      <!-- Botão de novo caminhão -->
      <a href="{% url 'core:truck_create' company.id %}" 
         class="px-3 py-2 text-sm font-medium text-white bg-primary hover:bg-primary/90 rounded-md transition-colors flex items-center w-full sm:w-auto justify-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
        </svg>
        Novo caminhão
      </a>
    </div>
  </div>

  <!-- Lista mobile (cards) -->
  <div class="block sm:hidden space-y-3 mb-6">
    {% for t in company.trucks.all %}
      <div class="border border-gray-200 rounded-md p-3 bg-white">
        <div class="flex items-center justify-between">
          <div class="text-base font-semibold text-secondary">{{ t.plate }}</div>
          <div class="text-xs text-gray-500">{{ t.truck_type.description }}</div>
        </div>
        <div class="mt-2 grid grid-cols-2 gap-x-4 gap-y-1 text-sm">
          <div><span class="text-gray-500">Frota:</span> {{ t.fleet|default:"—" }}</div>
          <div><span class="text-gray-500">Marca:</span> {{ t.brand|default:"—" }}</div>
          <div><span class="text-gray-500">Modelo:</span> {{ t.model|default:"—" }}</div>
        </div>
        <div class="mt-3 grid grid-cols-2 gap-2">
          <a href="{% url 'core:inspection_list' t.id %}"
             class="px-3 py-2 border border-gray-300 text-gray-700 rounded text-xs font-medium text-center hover:bg-gray-100 transition-colors">Inspeções</a>
          <a href="{% url 'core:inspection_create' t.id %}"
             class="px-3 py-2 bg-primary hover:bg-primary/90 text-secondary rounded text-xs font-medium text-center">Inspeção</a>
          <a href="{% url 'core:truck_edit' t.id %}"
             class="px-3 py-2 border border-blue-300 text-blue-700 rounded text-xs font-medium text-center hover:bg-blue-50 transition-colors">Editar</a>
          <form method="post" action="{% url 'core:truck_delete' t.id %}" onsubmit="return confirm('Excluir este caminhão? Esta ação não pode ser desfeita.');">
            {% csrf_token %}
            <button type="submit" class="w-full px-3 py-2 border border-red-300 text-red-700 rounded text-xs font-medium hover:bg-red-50 transition-colors">Excluir</button>
          </form>
        </div>
      </div>
    {% empty %}
      <div class="text-center text-gray-500 py-8">Nenhum caminhão encontrado.</div>
    {% endfor %}
  </div>

  <!-- Tabela de caminhões (desktop) -->
  <div class="hidden sm:block overflow-x-auto">
    <table class="w-full bg-white mb-6">
      <thead class="bg-gray-50 text-left">
        <tr>
          <th class="px-4 py-3 text-sm font-medium text-gray-600 uppercase tracking-wider">Placa</th>
          <th class="px-4 py-3 text-sm font-medium text-gray-600 uppercase tracking-wider">Tipo</th>
          <th class="px-4 py-3 text-sm font-medium text-gray-600 uppercase tracking-wider">Frota</th>
          <th class="px-4 py-3 text-sm font-medium text-gray-600 uppercase tracking-wider">Marca</th>
          <th class="px-4 py-3 text-sm font-medium text-gray-600 uppercase tracking-wider">Modelo</th>
          <th class="px-4 py-3 text-sm font-medium text-gray-600 uppercase tracking-wider">Ações</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200">
        {% for t in company.trucks.all %}
        <tr class="hover:bg-gray-50">
          <td class="px-4 py-3 text-sm">{{ t.plate }}</td>
          <td class="px-4 py-3 text-sm">{{ t.truck_type.description }}</td>
          <td class="px-4 py-3 text-sm">{{ t.fleet|default:"—" }}</td>
          <td class="px-4 py-3 text-sm">{{ t.brand }}</td>
          <td class="px-4 py-3 text-sm">{{ t.model }}</td>
          <td class="px-4 py-3 text-sm flex flex-wrap gap-2">
            <a href="{% url 'core:inspection_list' t.id %}"
               class="px-3 py-1 border border-gray-300 text-gray-700 rounded text-xs font-medium hover:bg-gray-100 transition-colors">
              Inspeções
            </a>
            <a href="{% url 'core:inspection_create' t.id %}"
               class="px-3 py-1 bg-primary hover:bg-primary/90 text-secondary rounded text-xs font-medium transition-colors flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
              </svg>
              Inspeção
            </a>
            <a href="{% url 'core:truck_edit' t.id %}"
               class="px-3 py-1 border border-blue-300 text-blue-700 rounded text-xs font-medium hover:bg-blue-50 transition-colors">
              Editar
            </a>
            <form method="post" action="{% url 'core:truck_delete' t.id %}" onsubmit="return confirm('Excluir este caminhão? Esta ação não pode ser desfeita.');">
              {% csrf_token %}
              <button type="submit" class="px-3 py-1 border border-red-300 text-red-700 rounded text-xs font-medium hover:bg-red-50 transition-colors">Excluir</button>
            </form>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="6" class="px-4 py-6 text-center text-gray-500">Nenhum caminhão encontrado.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  
  <!-- Botão voltar -->
  <div>
    <a href="{% url 'core:company_list' %}" class="px-5 py-2.5 bg-gray-200 hover:bg-gray-300 text-secondary font-medium rounded-md shadow-sm transition-colors flex items-center w-max">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
      </svg>
      Voltar
    </a>
  </div>
</div>
{% endblock %}
